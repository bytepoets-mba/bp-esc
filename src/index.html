<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BYTEPOETS - ESC</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
</head>
<body>
    <div class="container">
    <div id="checkLabel" style="position: absolute; top: 10px; left: 50%; transform: translateX(-50%); background: #006497; color: white; padding: 4px 12px; border-radius: 6px; font-size: 11px; font-family: 'SF Mono', monospace; font-weight: bold; z-index: 9999; -webkit-app-region: no-drag; box-shadow: 0 2px 8px rgba(0,0,0,0.2); white-space: nowrap; display: none;">
      <div style="display: flex; align-items: center; gap: 10px;">
        <div>ScrollH: <span id="shValue">0</span> | ClientH: <span id="chValue">0</span> | WinH: <span id="whValue">0</span> | <span id="focusValue">FOCUSED</span></div>
        <button id="openLogBtn" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 2px 6px; border-radius: 4px; cursor: pointer; font-size: 10px; font-family: inherit; font-weight: bold;">LOG</button>
      </div>
    </div>
      
      <div class="header-logo">
        <img src="assets/bp-logo.png" alt="BYTEPOETS Logo" id="bpLogo" />
      </div>

      <nav class="nav-tabs">
      <div class="nav-tab active" data-tab="balance">
        <span class="material-symbols-rounded">account_balance_wallet</span>OpenRouter
      </div>
      <div class="nav-tab" data-tab="mite">
        <span class="material-symbols-rounded">schedule</span>Mite
      </div>
      <div class="nav-tab" data-tab="settings" style="margin-left: auto">
        <span class="material-symbols-rounded">settings</span>Settings
      </div>
    </nav>

    <main class="content-area">
      <!-- Loading State -->
      <div id="loadingState" class="state hidden">
        <div class="loader"></div>
        <p style="text-align: center; color: #6b7280;">Loading...</p>
      </div>

      <!-- Balance Display State -->
      <div id="balanceState" class="state hidden">
        <div class="balance-summary">
          <div class="balance-overview">
            <div class="hex-zone">
              <button id="prevKeyBtn" class="btn-subtle key-nav-btn left" aria-label="Previous key">
                <span class="material-symbols-rounded nav-icon">chevron_left</span>
              </button>

              <div class="balance-hex">
                <div class="hex-caption" id="percentCaption">used</div>
                <div class="hex-row">
                  <div class="hex-side hex-side-left">
                    <div id="apiKeyLabelDisplay" class="key-label">-</div>
                  </div>
                  <canvas id="balancePie" width="50" height="50"></canvas>
                  <div class="hex-side hex-side-right">
                    <div class="hex-percent"><span id="exactPercent">-</span>%</div>
                  </div>
                </div>
              </div>

              <button id="nextKeyBtn" class="btn-subtle key-nav-btn right" aria-label="Next key">
                <span class="material-symbols-rounded nav-icon">chevron_right</span>
              </button>
            </div>

            <div class="balance-cards">
              <div class="balance-card">
                <div class="balance-card-header">
                  <span>Credit Limit</span>
                  <span class="badge" id="monthBadge">This month</span>
                </div>
                <div class="balance-item">
                  <span class="label">Limit</span>
                  <span class="value" id="limitValue">-</span>
                </div>
                <div class="balance-item">
                  <span class="label">Used</span>
                  <span class="value used" id="usageValue">-</span>
                </div>
                <div class="balance-item highlight">
                  <span class="label">Remaining</span>
                  <span class="value" id="remainingValue">-</span>
                </div>
              </div>

              <div class="usage-breakdown">
                <div class="usage-header">
                  <span>Usage Breakdown</span>
                  <span id="pacePill" class="pace-pill pace-pill--neutral">
                    <span class="pace-dot"></span>
                    <span id="paceText">-</span>
                  </span>
                </div>
                <div class="usage-row">
                  <span>Pace</span>
                  <span id="paceDetails">-</span>
                </div>
                <div class="usage-row">
                  <span>Today</span>
                  <span id="usageDaily">-</span>
                </div>
                <div class="usage-row">
                  <span>This Week</span>
                  <span id="usageWeekly">-</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="balance-footer-info">
          <div class="last-updated-row">
            <span id="lastUpdated" class="last-updated-text">Last updated: -</span>
            <button id="refreshBtn" class="btn-subtle">↻</button>
          </div>
        </div>
      </div>

      <!-- Mite Placeholder State -->
      <div id="miteState" class="state hidden">
        <div class="balance-card" style="text-align: center; padding: 3rem 1rem;">
          <div style="font-size: 2rem; margin-bottom: 1rem;">⏱️</div>
          <h3 style="margin-bottom: 0.5rem;">Mite Time Booking</h3>
          <p style="color: #6b7280; font-size: 0.9rem;">This feature is coming soon.</p>
        </div>
      </div>

      <!-- Settings State -->
      <div id="settingsState" class="state hidden">
        <div class="settings-section">
          <div class="settings-sub-tabs" style="display: flex; gap: 1.5rem; margin-bottom: 1.5rem; justify-content: center;">
            <button class="settings-sub-tab active" data-sub-tab="general">
              <span class="material-symbols-rounded">settings</span>General
            </button>
            <button class="settings-sub-tab" data-sub-tab="openrouter">
              <span class="material-symbols-rounded">key</span>OpenRouter
            </button>
          </div>
          
          <!-- OpenRouter Sub-Tab -->
          <div id="openrouterTab" class="settings-sub-content hidden">
            <div class="settings-grid" style="grid-template-columns: 1fr;">
              <div class="setting-item">
                <label>OpenRouter API Keys:</label>
                <div id="apiKeyList" class="api-key-list">
                  <!-- Keys injected here -->
                </div>
                <div class="api-key-add-row" style="margin-top: 0.5rem; display: flex; gap: 0.5rem;">
                  <input type="password" id="newApiKeyInput" placeholder="sk-or-v1-..." autocomplete="off" style="flex: 1;">
                  <button id="addApiKeyBtn" class="btn-primary" style="padding: 0 12px;">Add</button>
                </div>
              </div>
            </div>
            
            <div class="settings-grid">
              <div class="settings-col">
                <div class="setting-item side">
                  <label class="checkbox-label">
                    <input type="checkbox" id="autocheckToggle">
                    <span>Auto-refresh</span>
                  </label>
                  <div class="number-input">
                    <button id="refreshMinus" class="btn-icon">−</button>
                    <span id="refreshValue">5</span>
                    <button id="refreshPlus" class="btn-icon">+</button>
                    <span class="unit">Minutes</span>
                  </div>
                </div>

              </div>
              
              <div class="settings-col">
                <div class="setting-item side">
                  <label class="checkbox-label">
                    <input type="checkbox" id="showUnitToggle">
                    <span>Show Unit</span>
                  </label>
                </div>

                <div class="setting-item side">
                  <label>Display Unit:</label>
                  <div class="toggle-group">
                    <button id="unitPercent" class="btn-toggle active">%</button>
                    <button id="unitDollar" class="btn-toggle">$</button>
                  </div>
                </div>

                <div id="absTypeSection" class="setting-item side">
                  <label>Value Type:</label>
                  <div class="toggle-group">
                    <button id="typeRemaining" class="btn-toggle active">Remaining</button>
                    <button id="typeUsed" class="btn-toggle">Used</button>
                  </div>
                </div>

                <div class="setting-item side">
                  <label>Decimals:</label>
                  <div class="number-input">
                    <button id="decimalMinus" class="btn-icon">−</button>
                    <span id="decimalValue">0</span>
                    <button id="decimalPlus" class="btn-icon">+</button>
                  </div>
                </div>

              </div>
            </div>
          </div>
          </div>
          
          <!-- General Sub-Tab -->
          <div id="generalTab" class="settings-sub-content">
            <div class="settings-grid">
              <div class="settings-col">
                <div class="setting-item">
                  <label class="checkbox-label">
                    <input type="checkbox" id="shortcutEnabledToggle">
                    <span>Global Shortcut</span>
                  </label>
                  <input type="text" id="shortcutInput" placeholder="F19" autocomplete="off" style="margin-top: 0.5rem;">
                  <p class="help-text">Example: <code>F19</code>, <code>Cmd+Shift+B</code>, <code>Ctrl+Alt+S</code></p>
                </div>

                <div class="setting-item side">
                  <label for="startWindowToggle" class="checkbox-label">
                    <input type="checkbox" id="startWindowToggle">
                    <span>Show on Start</span>
                  </label>
                </div>

                <div class="setting-item side">
                  <label for="launchAtLoginToggle" class="checkbox-label">
                    <input type="checkbox" id="launchAtLoginToggle">
                    <span>Launch at Login</span>
                  </label>
                </div>

                <div class="setting-item side">
                  <label for="alwaysOnTopToggle" class="checkbox-label">
                    <input type="checkbox" id="alwaysOnTopToggle">
                    <span>Always on Top</span>
                  </label>
                </div>

                <div class="setting-item side">
                  <label for="unfocusedOverlayToggle" class="checkbox-label">
                    <input type="checkbox" id="unfocusedOverlayToggle">
                    <span>Dim Unfocused</span>
                  </label>
                </div>
              </div>
              
              <div class="settings-col">
                <div class="setting-item side">
                  <label for="debugLoggingToggle" class="checkbox-label">
                    <input type="checkbox" id="debugLoggingToggle">
                    <span>Enable Log File</span>
                  </label>
                </div>
              </div>
            </div>
            
            <div class="button-row" style="margin-top: 2rem; justify-content: center; gap: 12px;">
              <button id="checkForUpdatesBtn" class="btn-primary">Check for Updates</button>
              <button id="resetSettingsBtn" class="btn-secondary btn-reset">Reset App Data</button>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer class="footer">
      <div class="left">
        <a href="#" onclick="event.preventDefault(); window.__TAURI__.core.invoke('open_external_url', { url: 'https://github.com/bytepoets-mba/bp-esc' })">
          <svg viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
          <span id="appVersion"></span>
        </a>
      </div>
      <div class="center footer-actions">
        <button id="quitBtn" class="btn-secondary btn-reset btn-small">✕ Quit</button>
        <button id="hideBtn" class="btn-primary btn-small">Hide</button>
      </div>
      <div class="right">
        <a href="#" onclick="event.preventDefault(); window.__TAURI__.core.invoke('open_external_url', { url: 'https://www.gnu.org/licenses/agpl-3.0.html' })">
          <svg viewBox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm0 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm-1 5v2h2v-2h-2zm0 4v6h2v-6h-2z"/></svg>
          AGPL-3.0
        </a>
      </div>
    </footer>

    <!-- Error Display -->
    <div id="errorDisplay" class="error-message hidden"></div>

    <!-- Log Drawer -->
    <div id="logDrawer" class="log-drawer hidden">
      <div class="log-drawer-header">
        <span>Debug Logs</span>
        <div style="display: flex; gap: 8px;">
          <button id="openLogFileBtn" class="btn-subtle" style="padding: 2px 6px; font-size: 10px;">Open File</button>
          <button id="clearLogsBtn" class="btn-subtle" style="padding: 2px 6px; font-size: 10px;">Clear</button>
          <button id="closeLogDrawerBtn" class="btn-subtle" style="padding: 2px 6px; font-size: 10px;">✕</button>
        </div>
      </div>
      <div id="logContent" class="log-content"></div>
    </div>

    <!-- Confirm Dialog -->
    <div id="confirmDialog" class="dialog-overlay hidden">
      <div class="dialog-box">
        <p id="confirmMessage">Are you sure?</p>
        <div class="dialog-buttons">
          <button id="confirmCancel" class="btn-secondary">Cancel</button>
          <button id="confirmOk" class="btn-primary btn-danger">Reset</button>
        </div>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
