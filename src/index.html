<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BYTEPOETS - ESC</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <div id="checkLabel" style="position: absolute; top: 10px; left: 50%; transform: translateX(-50%); background: #6366f1; color: white; padding: 4px 12px; border-radius: 6px; font-size: 11px; font-family: 'SF Mono', monospace; font-weight: bold; z-index: 9999; -webkit-app-region: no-drag; box-shadow: 0 2px 8px rgba(0,0,0,0.2); white-space: nowrap; display: none;">
      SH: <span id="shValue">0</span> | CH: <span id="chValue">0</span> | WH: <span id="whValue">0</span>
    </div>
    <header class="header">
      <div class="tagline">BYTEPOETS - ESC</div>
      <img src="assets/bp-logo.png" alt="BYTEPOETS Logo" id="bpLogo" style="cursor: pointer; -webkit-app-region: no-drag;" />
    </header>

    <nav class="nav-tabs">
      <div class="nav-tab active" data-tab="balance">Balance</div>
      <div class="nav-tab" data-tab="mite">Mite</div>
      <div class="nav-tab" data-tab="settings" style="margin-left: auto">Settings</div>
    </nav>

    <main class="content-area">
      <!-- Loading State -->
      <div id="loadingState" class="state hidden">
        <div class="loader"></div>
        <p style="text-align: center; color: #6b7280;">Loading...</p>
      </div>

      <!-- Balance Display State -->
      <div id="balanceState" class="state hidden">
        <div class="balance-card">
          <div class="balance-item">
            <span class="label">Credit Limit:</span>
            <span class="value" id="limitValue">-</span>
          </div>
          <div class="balance-item">
            <span class="label">Used:</span>
            <span class="value" id="usageValue">-</span>
          </div>
          <div class="balance-item highlight">
            <span class="label">Remaining:</span>
            <span class="value" id="remainingValue">-</span>
          </div>
        </div>

        <div class="button-row">
          <button id="quitBtn" class="btn-secondary btn-reset">✕ Quit</button>
          <button id="refreshBtn" class="btn-secondary" style="flex:1">↻ Refresh</button>
          <button id="hideBtn" class="btn-primary" style="flex:0.5">Hide</button>
        </div>
      </div>

      <!-- Mite Placeholder State -->
      <div id="miteState" class="state hidden">
        <div class="balance-card" style="text-align: center; padding: 3rem 1rem;">
          <div style="font-size: 2rem; margin-bottom: 1rem;">⏱️</div>
          <h3 style="margin-bottom: 0.5rem;">Mite Time Booking</h3>
          <p style="color: #6b7280; font-size: 0.9rem;">This feature is coming soon.</p>
        </div>
      </div>

      <!-- Settings State -->
      <div id="settingsState" class="state hidden">
        <div class="settings-section">
          <h3 style="text-align: center; margin-bottom: 1.5rem;">Settings</h3>
          
          <div class="settings-grid">
            <div class="settings-col">
              <div class="setting-item">
                <label for="apiKeyInputSettings">OpenRouter API Key:</label>
                <input type="password" id="apiKeyInputSettings" placeholder="sk-or-v1-..." autocomplete="off">
              </div>

              <div class="setting-item">
                <label class="checkbox-label">
                  <input type="checkbox" id="autocheckToggle">
                  <span>Enable Auto-refresh</span>
                </label>
              </div>

              <div class="setting-item">
                <label>Refresh Interval (minutes):</label>
                <div class="number-input">
                  <button id="refreshMinus" class="btn-icon">−</button>
                  <span id="refreshValue">5</span>
                  <button id="refreshPlus" class="btn-icon">+</button>
                </div>
              </div>

              <div class="setting-item">
                <label class="checkbox-label">
                  <input type="checkbox" id="shortcutEnabledToggle">
                  <span>Enable Global Shortcut</span>
                </label>
              </div>

              <div class="setting-item">
                <label for="shortcutInput">Global Shortcut:</label>
                <input type="text" id="shortcutInput" placeholder="F19" autocomplete="off">
                <p class="help-text">Example: <code>Command+Shift+Option+Control+F19</code></p>
              </div>
            </div>

            <div class="settings-col">
              <div class="setting-item">
                <label>Display Unit:</label>
                <div class="toggle-group">
                  <button id="unitPercent" class="btn-toggle active">%</button>
                  <button id="unitDollar" class="btn-toggle">$</button>
                </div>
              </div>

              <div id="absTypeSection" class="setting-item">
                <label>Value Type:</label>
                <div class="toggle-group">
                  <button id="typeRemaining" class="btn-toggle active">Remaining</button>
                  <button id="typeUsed" class="btn-toggle">Used</button>
                </div>
              </div>

              <div class="setting-item">
                <label class="checkbox-label">
                  <input type="checkbox" id="showUnitToggle">
                  <span>Show Unit in Menubar</span>
                </label>
              </div>

              <div class="setting-item">
                <label for="startWindowToggle" class="checkbox-label">
                  <input type="checkbox" id="startWindowToggle">
                  <span>Show Window on App Start</span>
                </label>
              </div>

              <div class="setting-item">
                <label for="opacitySlider">Window Opacity: <span id="opacityDisplay">90%</span></label>
                <input type="range" id="opacitySlider" min="50" max="100" step="1" value="90" style="width: 100%; margin-top: 0.5rem; -webkit-app-region: no-drag; cursor: pointer;">
              </div>
            </div>
          </div>

          <div class="button-row" style="margin-top: 1rem;">
            <button id="resetSettingsBtn" class="btn-secondary btn-reset">Reset App Data</button>
            <button id="saveSettingsBtn" class="btn-primary">Done</button>
          </div>
        </div>
      </div>
    </main>

    <footer class="footer">
      <div class="left">
        <a href="#" onclick="event.preventDefault(); window.__TAURI__.core.invoke('open_external_url', { url: 'https://github.com/bytepoets-mba/bp-esc' })">
          <svg viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
          GitHub <span id="appVersion"></span>
        </a>
      </div>
      <div class="center" id="lastUpdated">-</div>
      <div class="right">
        <a href="#" onclick="event.preventDefault(); window.__TAURI__.core.invoke('open_external_url', { url: 'https://www.gnu.org/licenses/agpl-3.0.html' })">
          <svg viewBox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm0 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm-1 5v2h2v-2h-2zm0 4v6h2v-6h-2z"/></svg>
          AGPL-3.0
        </a>
      </div>
    </footer>

    <!-- Error Display -->
    <div id="errorDisplay" class="error-message hidden"></div>

    <!-- Confirm Dialog -->
    <div id="confirmDialog" class="dialog-overlay hidden">
      <div class="dialog-box">
        <p id="confirmMessage">Are you sure?</p>
        <div class="dialog-buttons">
          <button id="confirmCancel" class="btn-secondary">Cancel</button>
          <button id="confirmOk" class="btn-primary btn-danger">Reset</button>
        </div>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
